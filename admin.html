<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin â€“ Ramadan Kalender 2026</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Login Gate -->
    <div class="admin-login" id="adminLogin">
        <h2>ğŸ” Admin-Bereich</h2>
        <p style="color:var(--text-secondary); font-size:0.85rem; margin-bottom:20px;">
            Dieser Bereich ist nur fÃ¼r den Administrator zugÃ¤nglich.
        </p>
        <input type="password" id="adminPassword" placeholder="Passwort eingeben" autocomplete="current-password">
        <button onclick="checkPassword()" id="loginBtn">Einloggen</button>
        <p id="loginError" style="color:#ff6b6b; font-size:0.82rem; margin-top:10px; display:none;">
            âŒ Falsches Passwort
        </p>
    </div>

    <!-- Admin Content (hidden until login) -->
    <div class="admin-page" id="adminContent" style="display:none;">
        <a href="index.html" class="setup-back">â† ZurÃ¼ck zum Kalender</a>

        <div class="admin-header">
            <h1>ğŸ” Admin-Bereich</h1>
            <p>Alle 30 TÃ¼ren auf einen Blick â€“ nur fÃ¼r dich sichtbar.</p>
        </div>

        <!-- Stats -->
        <div id="adminStats" style="
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 24px;
        "></div>

        <!-- Doors Grid -->
        <div class="admin-grid" id="adminGrid">
            <!-- Built by JS -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        /* ======================================
           ADMIN PAGE LOGIC
           Only accessible via direct URL
           ====================================== */

        const SUPABASE_URL = 'https://thscbzyzblpqwbskymbg.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_w4wZcJW_TOnzxlgr-kMr5Q_aCu8OxTz';

        // Admin password â€“ change this to something secure!
        const ADMIN_PASSWORD_HASH = 'ramadan2026admin';

        let supabaseClient = null;
        try {
            if (window.supabase && window.supabase.createClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            }
        } catch (e) { }

        // Fallback tasks (same as main script)
        const FALLBACK_TASKS = [
            { day: 1, icon: 'ğŸ˜Š', title: 'LÃ¤cheln schenken', task: 'Schenke heute jemandem ein ehrliches LÃ¤cheln und sag etwas Nettes.' },
            { day: 2, icon: 'ğŸ¤²', title: 'Dua fÃ¼r andere', task: 'Bete heute ein Dua fÃ¼r jemanden, den du liebst.' },
            { day: 3, icon: 'ğŸ“–', title: 'Quran lesen', task: 'Lies heute mindestens eine Seite aus dem Quran.' },
            { day: 4, icon: 'ğŸ½ï¸', title: 'Essen teilen', task: 'Teile heute dein Essen mit einem Nachbarn oder Freund.' },
            { day: 5, icon: 'ğŸ§¹', title: 'Helfen im Haushalt', task: 'Hilf heute ohne gefragt zu werden im Haushalt mit.' },
            { day: 6, icon: 'ğŸ’Œ', title: 'Brief schreiben', task: 'Schreibe einen lieben Brief oder eine Nachricht an jemanden.' },
            { day: 7, icon: 'ğŸŒ³', title: 'Natur genieÃŸen', task: 'Gehe heute nach drauÃŸen und danke Allah fÃ¼r die Natur.' },
            { day: 8, icon: 'ğŸ¤', title: 'VersÃ¶hnung', task: 'VersÃ¶hne dich heute mit jemandem, mit dem du im Streit warst.' },
            { day: 9, icon: 'ğŸ’°', title: 'Spenden', task: 'Spende heute etwas â€“ egal wie klein â€“ fÃ¼r einen guten Zweck.' },
            { day: 10, icon: 'ğŸ§¸', title: 'Spielzeug verschenken', task: 'Verschenke ein Spielzeug, das du nicht mehr brauchst.' },
            { day: 11, icon: 'ğŸ•Œ', title: 'Moschee besuchen', task: 'Besuche heute die Moschee fÃ¼r ein gemeinsames Gebet.' },
            { day: 12, icon: 'ğŸ‘´', title: 'Ã„ltere besuchen', task: 'Besuche oder rufe heute Oma, Opa oder Ã¤ltere Nachbarn an.' },
            { day: 13, icon: 'ğŸ¨', title: 'Kreativ sein', task: 'Male ein schÃ¶nes Bild zum Thema Ramadan.' },
            { day: 14, icon: 'ğŸ™', title: 'Extra Gebet', task: 'Bete heute ein zusÃ¤tzliches freiwilliges Gebet.' },
            { day: 15, icon: 'ğŸ“š', title: 'Geschichte lernen', task: 'Lerne heute eine Geschichte Ã¼ber einen Propheten.' },
            { day: 16, icon: 'ğŸ¥¤', title: 'Wasser schÃ¤tzen', task: 'Denke heute beim Trinken daran, wie wertvoll Wasser ist.' },
            { day: 17, icon: 'ğŸŒ™', title: 'Nachtgebet', task: 'Versuche heute Nacht aufzustehen und ein kurzes Gebet zu sprechen.' },
            { day: 18, icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', title: 'Familie', task: 'Verbringe heute bewusst Zeit mit deiner Familie.' },
            { day: 19, icon: 'ğŸª', title: 'Backen', task: 'Backe heute Kekse oder Kuchen und teile sie mit anderen.' },
            { day: 20, icon: 'ğŸ—‘ï¸', title: 'AufrÃ¤umen', task: 'RÃ¤ume heute dein Zimmer grÃ¼ndlich auf und halte es sauber.' },
            { day: 21, icon: 'ğŸ¤«', title: 'Geduld Ã¼ben', task: 'Ãœbe heute besonders viel Geduld â€“ auch wenn es schwer fÃ¤llt.' },
            { day: 22, icon: 'ğŸ', title: 'Ãœberraschung', task: 'Ãœberrasche heute jemanden mit einer kleinen Freude.' },
            { day: 23, icon: 'ğŸ’§', title: 'Dhikr machen', task: 'Sage heute 100 Mal "SubhanAllah" Ã¼ber den Tag verteilt.' },
            { day: 24, icon: 'ğŸŒŸ', title: 'Vorbild sein', task: 'Sei heute ein gutes Vorbild fÃ¼r andere Kinder.' },
            { day: 25, icon: 'ğŸ“¿', title: 'Dankbarkeit', task: 'Schreibe 5 Dinge auf, fÃ¼r die du heute dankbar bist.' },
            { day: 26, icon: 'ğŸ•Šï¸', title: 'Frieden stiften', task: 'Hilf heute dabei, einen Streit zwischen anderen zu schlichten.' },
            { day: 27, icon: 'âœ¨', title: 'Lailat al-Qadr', task: 'Heute kÃ¶nnte die Nacht der Bestimmung sein â€“ bete besonders viel!' },
            { day: 28, icon: 'ğŸ§•', title: 'Eltern ehren', task: 'Sage heute deinen Eltern, wie sehr du sie liebst.' },
            { day: 29, icon: 'ğŸŒ…', title: 'Sonnenaufgang', task: 'Stehe heute frÃ¼h auf und beobachte den Sonnenaufgang.' },
            { day: 30, icon: 'ğŸ‰', title: 'Bayram-Vorfreude', task: 'Bereite dich heute auf das Bayram-Fest vor â€“ dein Geschenk wartet! ğŸ' }
        ];

        // ========== PASSWORD CHECK ==========
        function checkPassword() {
            const input = document.getElementById('adminPassword').value;
            if (input === ADMIN_PASSWORD || sessionStorage.getItem('admin_auth') === 'true') {
                sessionStorage.setItem('admin_auth', 'true');
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminData();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // Check if already authenticated via session
        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('admin_auth') === 'true') {
                checkPassword();
            } else {
                const pwInput = document.getElementById('adminPassword');
                if (pwInput) {
                    pwInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') checkPassword();
                    });
                    pwInput.focus();
                }
            }
        });

        // ========== LOAD ADMIN DATA ==========
        async function loadAdminData() {
            let tasks = [...FALLBACK_TASKS];

            // Try to load from Supabase
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('daily_tasks')
                        .select('*')
                        .order('day', { ascending: true });

                    if (!error && data && data.length > 0) {
                        tasks = data;
                    }
                } catch (e) { }

                // Load stats
                try {
                    const { count } = await supabaseClient
                        .from('families')
                        .select('*', { count: 'exact', head: true });

                    renderStats(count || 0);
                } catch (e) {
                    renderStats('â€“');
                }
            }

            renderDoors(tasks);
        }

        // ========== RENDER STATS ==========
        function renderStats(familyCount) {
            const container = document.getElementById('adminStats');
            if (!container) return;

            const stats = [
                { label: 'Familien registriert', value: familyCount, icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' },
                { label: 'TÃ¼ren gesamt', value: 30, icon: 'ğŸšª' },
                { label: 'App Version', value: '1.0.0', icon: 'ğŸ“±' }
            ];

            container.innerHTML = stats.map(s => `
                <div style="
                    background: linear-gradient(135deg, var(--bg-accent), var(--bg-mid));
                    border: 1px solid rgba(212,168,67,0.2);
                    border-radius: var(--radius-md);
                    padding: 16px 24px;
                    text-align: center;
                    min-width: 140px;
                ">
                    <div style="font-size: 1.8rem; margin-bottom: 6px;">${s.icon}</div>
                    <div style="font-size: 1.4rem; font-weight: 700; color: var(--gold-light);">${s.value}</div>
                    <div style="font-size: 0.78rem; color: var(--text-secondary);">${s.label}</div>
                </div>
            `).join('');
        }

        // ========== RENDER DOORS ==========
        function renderDoors(tasks) {
            const grid = document.getElementById('adminGrid');
            if (!grid) return;
            grid.innerHTML = '';

            tasks.forEach(task => {
                const door = document.createElement('div');
                door.className = 'admin-door';
                door.innerHTML = `
                    <div class="admin-door-header">
                        <div class="admin-door-num">${task.day}</div>
                        <div class="admin-door-title">${task.icon || 'ğŸŒ™'} ${escapeHtml(task.title)}</div>
                    </div>
                    <div class="admin-door-task">${escapeHtml(task.task)}</div>
                `;
                grid.appendChild(door);
            });
        }

        function escapeHtml(str) {
            if (typeof str !== 'string') return '';
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }
    </script>
</body>

</html>