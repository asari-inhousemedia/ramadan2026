<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin â€“ Ramadan Kalender 2026</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Login Gate -->
    <div class="admin-login" id="adminLogin">
        <h2>ğŸ” Admin-Bereich</h2>
        <p style="color:var(--text-secondary); font-size:0.85rem; margin-bottom:20px;">
            Dieser Bereich ist nur fÃ¼r den Administrator zugÃ¤nglich.
        </p>
        <input type="password" id="adminPassword" placeholder="Passwort eingeben" autocomplete="current-password">
        <button onclick="checkPassword()" id="loginBtn">Einloggen</button>
        <p id="loginError" style="color:#ff6b6b; font-size:0.82rem; margin-top:10px; display:none;">
            âŒ Falsches Passwort
        </p>
    </div>

    <!-- Admin Content (hidden until login) -->
    <div class="admin-page" id="adminContent" style="display:none;">
        <a href="index.html" class="setup-back">â† ZurÃ¼ck zum Kalender</a>

        <div class="admin-header">
            <h1>ğŸ” Admin-Bereich</h1>
            <p>Alle 30 TÃ¼ren auf einen Blick â€“ nur fÃ¼r dich sichtbar.</p>
        </div>

        <!-- Stats -->
        <div id="adminStats" style="
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 24px;
        "></div>

        <!-- Doors Grid -->
        <div class="admin-grid" id="adminGrid">
            <!-- Built by JS -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        /* ======================================
           ADMIN PAGE LOGIC
           Only accessible via direct URL
           ====================================== */

        const SUPABASE_URL = 'https://thscbzyzblpqwbskymbg.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_w4wZcJW_TOnzxlgr-kMr5Q_aCu8OxTz';

        // Admin password â€“ change this to something secure!
        const ADMIN_PASSWORD_HASH = 'ramadan2026admin';

        let supabaseClient = null;
        try {
            if (window.supabase && window.supabase.createClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            }
        } catch (e) { }

        // Fallback tasks (same as main script)
        const FALLBACK_TASKS = [
            { id: 'f1-1', day: 1, icon: 'ğŸ‘‹', title: 'BegrÃ¼ÃŸung', task: 'Sage â€Ramadan Mubarak!" oder â€HayÄ±rlÄ± Ramazanlar!" zu jedem in deiner Familie.' },
            { id: 'f1-2', day: 1, icon: 'ğŸ§ ', title: 'Verstehen', task: 'Frage deine Eltern: â€Warum fasten Muslime im Ramadan?" und hÃ¶r gut zu.' },
            { id: 'f1-3', day: 1, icon: 'â¤ï¸', title: 'Herzensaufgabe', task: 'Male ein Bild oder zeichne etwas, auf das du dich im Ramadan freust.' },
            { id: 'f2-1', day: 2, icon: 'ğŸ¤', title: 'Helfen', task: 'Hilf beim Tischdecken fÃ¼r das Iftar-Essen.' },
            { id: 'f2-2', day: 2, icon: 'ğŸŒ™', title: 'Freundlichkeit', task: 'Sage heute mindestens 3 Mal â€Danke" â€“ ohne dass jemand dich daran erinnert.' },
            { id: 'f2-3', day: 2, icon: 'ğŸŒ™', title: 'Aufmerksamkeit', task: 'Frage jemanden in der Familie: â€Kann ich dir helfen?"' },
            { id: 'f3-1', day: 3, icon: 'ğŸ§ ', title: 'Nachdenken', task: 'Denke an 3 Dinge, fÃ¼r die du heute dankbar bist â€“ erzÃ¤hle sie deinen Eltern.' },
            { id: 'f3-2', day: 3, icon: 'ğŸ™', title: 'DankeschÃ¶n sagen', task: 'Bedanke dich bei jemandem, dem du noch nie richtig â€Danke" gesagt hast.' },
            { id: 'f3-3', day: 3, icon: 'ğŸ§ ', title: 'Vergleichen', task: 'Sprecht in der Familie darÃ¼ber: Was haben wir, das andere nicht haben?' },
            { id: 'f4', day: 4, icon: 'ğŸ½ï¸', title: 'Essen teilen', task: 'Teile heute dein Essen mit einem Nachbarn oder Freund.' },
            { id: 'f5', day: 5, icon: 'ğŸ§¹', title: 'Helfen im Haushalt', task: 'Hilf heute ohne gefragt zu werden im Haushalt mit.' }
        ];

        // ========== PASSWORD CHECK ==========
        function checkPassword() {
            const input = document.getElementById('adminPassword').value;
            // Simplified check for now. Later we can integrate actual Supabase Auth.
            if (input === ADMIN_PASSWORD_HASH || sessionStorage.getItem('admin_auth') === 'true') {
                sessionStorage.setItem('admin_auth', 'true');
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminData();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // Check if already authenticated via session
        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('admin_auth') === 'true') {
                checkPassword();
            } else {
                const pwInput = document.getElementById('adminPassword');
                if (pwInput) {
                    pwInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') checkPassword();
                    });
                    pwInput.focus();
                }
            }
        });

        // ========== LOAD ADMIN DATA ==========
        async function loadAdminData() {
            let tasks = [...FALLBACK_TASKS];

            // Try to load from Supabase
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient
                        .from('daily_tasks')
                        .select('*')
                        .order('day', { ascending: true });

                    if (!error && data && data.length > 0) {
                        tasks = data;
                    }
                } catch (e) { }

                // Load stats
                try {
                    const { count } = await supabaseClient
                        .from('families')
                        .select('*', { count: 'exact', head: true });

                    renderStats(count || 0);
                } catch (e) {
                    renderStats('â€“');
                }
            }

            renderDoors(tasks);
        }

        // ========== RENDER STATS ==========
        function renderStats(familyCount) {
            const container = document.getElementById('adminStats');
            if (!container) return;

            const stats = [
                { label: 'Familien registriert', value: familyCount, icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' },
                { label: 'TÃ¼ren gesamt', value: 30, icon: 'ğŸšª' },
                { label: 'App Version', value: '1.0.0', icon: 'ğŸ“±' }
            ];

            container.innerHTML = stats.map(s => `
                <div style="
                    background: linear-gradient(135deg, var(--bg-accent), var(--bg-mid));
                    border: 1px solid rgba(212,168,67,0.2);
                    border-radius: var(--radius-md);
                    padding: 16px 24px;
                    text-align: center;
                    min-width: 140px;
                ">
                    <div style="font-size: 1.8rem; margin-bottom: 6px;">${s.icon}</div>
                    <div style="font-size: 1.4rem; font-weight: 700; color: var(--gold-light);">${s.value}</div>
                    <div style="font-size: 0.78rem; color: var(--text-secondary);">${s.label}</div>
                </div>
            `).join('');
        }

        // ========== RENDER DOORS ==========
        function renderDoors(tasks) {
            const grid = document.getElementById('adminGrid');
            if (!grid) return;
            grid.innerHTML = '';

            tasks.forEach(task => {
                const door = document.createElement('div');
                door.className = 'admin-door';
                door.innerHTML = `
                    <div class="admin-door-header">
                        <div class="admin-door-num">${task.day}</div>
                        <div class="admin-door-title">${task.icon || 'ğŸŒ™'} ${escapeHtml(task.title)}</div>
                    </div>
                    <div class="admin-door-task">${escapeHtml(task.task)}</div>
                `;
                grid.appendChild(door);
            });
        }

        function escapeHtml(str) {
            if (typeof str !== 'string') return '';
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }
    </script>
</body>

</html>